<%- include('../partials/header') %>

<div class="admin-header">
    <div>
        <h1 class="admin-page-title">Perguntas do Quiz</h1>
        <p class="admin-page-description">Gerencie as perguntas do jogo "IA ou NÃ£o?"</p>
    </div>
    <a href="/admin/quiz/new" class="admin-btn admin-btn-primary">
        <svg style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        Nova Pergunta
    </a>
</div>

<div class="admin-content">
    <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
        <div style="margin-bottom:1rem; padding:0.75rem; border-radius:6px; background:#ffe6e6; color:#a00;">
            <strong>Erro:</strong> <%= errorMessage %>
        </div>
    <% } %>
    <% if (typeof successMessage !== 'undefined' && successMessage) { %>
        <div style="margin-bottom:1rem; padding:0.75rem; border-radius:6px; background:#e6ffea; color:#0a0;">
            <strong>Sucesso:</strong> <%= successMessage %>
        </div>
    <% } %>

    <% if (questions && questions.length > 0) { %>
        <div class="admin-card">
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th style="width: 50%;">Texto da Pergunta</th>
                            <th style="width: 15%;">Categoria</th>
                            <th style="width: 15%;">Resposta</th>
                            <th style="width: 10%;">Status</th>
                            <th style="width: 10%;">AÃ§Ãµes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% questions.forEach(question => { %>
                            <tr>
                                <td>
                                    <div style="max-width: 500px; white-space: normal;">
                                        <%= question.prompt %>
                                    </div>
                                </td>
                                <td>
                                    <% 
                                    const typeLabels = {
                                        'IMAGE_CLASSIFY': 'ðŸ–¼ï¸ Imagem',
                                        'IMAGE_COMPARE': 'ðŸ–¼ï¸ðŸ†šðŸ–¼ï¸ Compare',
                                        'TEXT_CLASSIFY': 'ðŸ“ Texto',
                                        'HALLUCINATION_DETECT': 'ðŸ” AlucinaÃ§Ã£o',
                                        'LGPD_TRAFFIC_LIGHT': 'ðŸš¦ LGPD'
                                    };
                                    %>
                                    <span class="admin-badge admin-badge-secondary">
                                        <%= typeLabels[question.type] || question.type || 'Geral' %>
                                    </span>
                                </td>
                                <td>
                                    <% if (question.type === 'IMAGE_COMPARE') { %>
                                        <% if (question.correctOption === 0) { %>
                                            <span class="admin-badge admin-badge-success">Img A Ã© IA</span>
                                        <% } else { %>
                                            <span class="admin-badge admin-badge-danger">Img B Ã© IA</span>
                                        <% } %>
                                    <% } else { %>
                                        <% if (question.correctOption === 0) { %>
                                            <span class="admin-badge admin-badge-success">IA</span>
                                        <% } else { %>
                                            <span class="admin-badge admin-badge-danger">NÃ£o IA</span>
                                        <% } %>
                                    <% } %>
                                </td>
                                <td>
                                    <form action="/admin/quiz/<%= question.id %>/toggle" method="POST" style="display: inline;">
                                        <% if (question.isActive) { %>
                                            <button type="submit" class="admin-badge admin-badge-success" style="border: none; cursor: pointer;">
                                                Ativo
                                            </button>
                                        <% } else { %>
                                            <button type="submit" class="admin-badge admin-badge-secondary" style="border: none; cursor: pointer;">
                                                Inativo
                                            </button>
                                        <% } %>
                                    </form>
                                </td>
                                <td>
                                    <div class="admin-action-buttons">
                                        <a href="/admin/quiz/<%= question.id %>/edit" class="admin-btn-icon" title="Editar">
                                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                            </svg>
                                        </a>
                                        <button 
                                            class="admin-btn-icon admin-btn-danger admin-btn-delete" 
                                            title="Excluir"
                                            data-delete-form="delete-<%= question.id %>"
                                        >
                                            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                            </svg>
                                        </button>
                                        <form id="delete-<%= question.id %>" action="/admin/quiz/<%= question.id %>/delete" method="POST" style="display: none;"></form>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>
    <% } else { %>
        <div class="admin-card">
            <div class="admin-card-body" style="text-align: center; padding: 3rem 1.5rem;">
                <svg style="width: 4rem; height: 4rem; margin: 0 auto 1rem; color: var(--admin-text-tertiary);" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p style="color: var(--admin-text-secondary); margin-bottom: 1.5rem;">
                    Nenhuma pergunta cadastrada ainda
                </p>
                <a href="/admin/quiz/new" class="admin-btn admin-btn-primary">
                    <svg style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                    Criar Primeira Pergunta
                </a>
            </div>
        </div>
    <% } %>
</div>

<%- include('../partials/footer') %>

<script src="/admin/js/quiz-list.js"></script>
