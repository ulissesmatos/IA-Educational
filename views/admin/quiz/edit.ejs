<%- include('../partials/header') %>

<div class="admin-header">
    <div>
        <h1 class="admin-page-title">
            <%= question ? 'Editar Pergunta' : 'Nova Pergunta' %>
        </h1>
        <p class="admin-page-description">
            <%= question ? 'Atualize os dados da pergunta' : 'Crie uma nova pergunta para o quiz' %>
        </p>
    </div>
    <a href="/admin/quiz" class="admin-btn admin-btn-secondary">
        <svg style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Voltar
    </a>
</div>

<div class="admin-content">
    <% if (errors && errors.length > 0) { %>
        <div class="admin-alert admin-alert-danger">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
                <% errors.forEach(error => { %>
                    <p><%= error.msg %></p>
                <% }); %>
            </div>
        </div>
    <% } %>
    
    <div class="admin-card">
        <form action="<%= question ? `/admin/quiz/${question.id}` : '/admin/quiz' %>" method="POST">
            <div class="admin-card-body">
                <!-- Texto da Pergunta -->
                <div class="admin-form-group">
                    <label class="admin-form-label">
                        Texto da Pergunta
                        <span style="color: var(--admin-danger);">*</span>
                    </label>
                    <textarea 
                        name="prompt" 
                        class="admin-form-input" 
                        rows="3" 
                        required
                        placeholder="Ex: Esta imagem foi gerada por IA?"
                    ><%= question ? question.prompt : (formData ? formData.prompt : '') %></textarea>
                    <p class="admin-form-help">Escreva a pergunta que será exibida aos jogadores</p>
                </div>
                
                <!-- Tipo de Questão -->
                <div class="admin-form-group">
                    <label class="admin-form-label">
                        Tipo de Questão
                    </label>
                    <select name="type" class="admin-form-input" id="question-type">
                        <option value="IMAGE_CLASSIFY" <%= (question && question.type === 'IMAGE_CLASSIFY') || (formData && formData.type === 'IMAGE_CLASSIFY') || (!question && !formData) ? 'selected' : '' %>>
                            Classificar Imagem (IA ou Humano)
                        </option>
                        <option value="IMAGE_COMPARE" <%= (question && question.type === 'IMAGE_COMPARE') || (formData && formData.type === 'IMAGE_COMPARE') ? 'selected' : '' %>>
                            Comparar 2 Imagens (Qual é IA?)
                        </option>
                        <option value="TEXT_CLASSIFY" <%= (question && question.type === 'TEXT_CLASSIFY') || (formData && formData.type === 'TEXT_CLASSIFY') ? 'selected' : '' %>>
                            Classificar Texto (IA ou Humano)
                        </option>
                        <option value="HALLUCINATION_DETECT" <%= (question && question.type === 'HALLUCINATION_DETECT') || (formData && formData.type === 'HALLUCINATION_DETECT') ? 'selected' : '' %>>
                            Detectar Alucinação
                        </option>
                        <option value="LGPD_TRAFFIC_LIGHT" <%= (question && question.type === 'LGPD_TRAFFIC_LIGHT') || (formData && formData.type === 'LGPD_TRAFFIC_LIGHT') ? 'selected' : '' %>>
                            Semáforo LGPD
                        </option>
                    </select>
                    <p class="admin-form-help">Tipo de pergunta do quiz. "Comparar 2 Imagens" exibe duas imagens lado a lado.</p>
                </div>
                
                <!-- Resposta Correta -->
                <div class="admin-form-group">
                    <label class="admin-form-label">
                        Resposta Correta
                        <span style="color: var(--admin-danger);">*</span>
                    </label>
                    <div style="display: flex; gap: 1rem;">
                        <label class="admin-radio-label">
                            <input 
                                type="radio" 
                                name="correctOption" 
                                value="0"
                                <%= (question && question.correctOption === 0) || (formData && formData.correctOption === '0') ? 'checked' : '' %>
                                required
                            >
                            <span>IA (Primeira opção)</span>
                        </label>
                        <label class="admin-radio-label">
                            <input 
                                type="radio" 
                                name="correctOption" 
                                value="1"
                                <%= (question && question.correctOption === 1) || (formData && formData.correctOption === '1') || (!question && !formData) ? 'checked' : '' %>
                                required
                            >
                            <span>Não IA (Segunda opção)</span>
                        </label>
                    </div>
                    <p class="admin-form-help">Selecione se o conteúdo foi criado por IA ou não</p>
                </div>
                
                <!-- Explicação -->
                <div class="admin-form-group">
                    <label class="admin-form-label">
                        Explicação
                        <span style="color: var(--admin-danger);">*</span>
                    </label>
                    <textarea 
                        name="explanation" 
                        class="admin-form-input" 
                        rows="4"
                        required
                        placeholder="Ex: Esta imagem apresenta características típicas de IA como..."
                    ><%= question ? question.explanation || '' : (formData ? formData.explanation || '' : '') %></textarea>
                    <p class="admin-form-help">Explicação que será mostrada após a resposta</p>
                </div>
                
                <!-- URL da Imagem -->
                <div class="admin-form-group">
                    <label class="admin-form-label">
                        URL da Imagem <span id="image1-label">(Imagem principal)</span>
                    </label>
                    <input 
                        type="text" 
                        name="imageUrl" 
                        class="admin-form-input"
                        value="<%= question ? question.imageUrl || '' : (formData ? formData.imageUrl || '' : '') %>"
                        placeholder="/images/minha-imagem.jpg ou https://exemplo.com/imagem.jpg"
                    >
                    <p class="admin-form-help">URL da imagem relacionada à pergunta (opcional). Pode ser caminho local ou URL externa.</p>
                </div>
                
                <!-- URL da Segunda Imagem (para IMAGE_COMPARE) -->
                <div class="admin-form-group" id="image2-group" style="display: none;">
                    <label class="admin-form-label">
                        URL da Segunda Imagem
                        <span style="color: var(--admin-danger);">*</span>
                    </label>
                    <input 
                        type="text" 
                        name="imageUrl2" 
                        class="admin-form-input"
                        value="<%= question ? question.imageUrl2 || '' : (formData ? formData.imageUrl2 || '' : '') %>"
                        placeholder="/images/segunda-imagem.jpg ou https://exemplo.com/imagem2.jpg"
                    >
                    <p class="admin-form-help">Segunda imagem para comparação. O jogador escolherá qual das duas é IA.</p>
                </div>
                
                <!-- Status Ativo -->
                <div class="admin-form-group">
                    <label class="admin-checkbox-label">
                        <input 
                            type="checkbox" 
                            name="isActive" 
                            value="true"
                            <%= (question && question.isActive) || (!question && !formData) || (formData && formData.isActive === 'true') ? 'checked' : '' %>
                        >
                        <span>Pergunta ativa (disponível para uso no jogo)</span>
                    </label>
                </div>
            </div>
            
            <div class="admin-card-footer">
                <button type="submit" class="admin-btn admin-btn-primary">
                    <svg style="width: 1.25rem; height: 1.25rem; margin-right: 0.5rem;" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <%= question ? 'Atualizar Pergunta' : 'Criar Pergunta' %>
                </button>
                <a href="/admin/quiz" class="admin-btn admin-btn-secondary">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</div>

<%- include('../partials/footer') %>

<script src="/admin/js/quiz-form.js"></script>
